databaseChangeLog:
  - changeSet:
      id: 200-create-discount-rules
      author: Albert Kamalov
      changes:
        - createTable:
            tableName: discount_rules
            columns:
              - column: { name: id, type: BIGSERIAL, constraints: { primaryKey: true, primaryKeyName: pk_discount_rules } }
              - column: { name: scope, type: VARCHAR(32), constraints: { nullable: false } } # 'CATEGORY' | 'SKU_SUFFIX'
              - column: { name: category_id, type: BIGINT }       # nullable, when scope=CATEGORY
              - column: { name: sku_suffix, type: VARCHAR(16) }   # nullable, when scope=SKU_SUFFIX
              - column: { name: percent, type: BIGINT, constraints: { nullable: false } }
              - column: { name: created_at, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: NOW(), constraints: { nullable: false } }
              - column: { name: updated_at, type: TIMESTAMP WITH TIME ZONE, defaultValueComputed: NOW(), constraints: { nullable: false } }
              - column: { name: version, type: BIGINT, defaultValueNumeric: 0, constraints: { nullable: false } }
        - addForeignKeyConstraint:
            baseTableName: discount_rules
            baseColumnNames: category_id
            referencedTableName: categories
            referencedColumnNames: id
            constraintName: fk_disc_category
            onDelete: RESTRICT
            onUpdate: RESTRICT